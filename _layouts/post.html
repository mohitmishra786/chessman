---
layout: default
---

<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>{{ page.title }}</title>
        <script
            type="text/javascript"
            async
            src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"
        ></script>
        <script src="https://unpkg.com/d3@5.16.0/dist/d3.min.js"></script>
        <script src="https://unpkg.com/@hpcc-js/wasm@0.3.11/dist/index.min.js"></script>
        <script src="https://unpkg.com/d3-graphviz@3.1.0/build/d3-graphviz.min.js"></script>
    </head>
    <body>
        <article
            class="post h-entry"
            itemscope
            itemtype="http://schema.org/BlogPosting"
        >
            <header class="post-header">
                <div class="post-back">
                    <a class="black-link" href="{{ site.url | relative_url }}">
                        ← {{ site.moving.back_to }}
                    </a>
                </div>
                <h1 class="post-title p-name" itemprop="name headline">
                    {{ page.title | escape }}
                </h1>
                <p class="post-meta">
                    <time
                        class="dt-published"
                        datetime="{{ page.date | date_to_xmlschema }}"
                        itemprop="datePublished"
                    >
                        {%- assign date_format = "%b %-d, %Y" -%} {{ page.date |
                        date: date_format }}
                    </time>
                    {%- if page.author -%} •
                    <span
                        itemprop="author"
                        itemscope
                        itemtype="http://schema.org/Person"
                        ><span class="p-author h-card" itemprop="name"
                            >{{ page.author | escape }}</span
                        ></span
                    >
                    {%- endif -%}
                </p>
            </header>
            <div class="post-content e-content" itemprop="articleBody">
                {{ content }}
                <div id="upvote-section">
                    <button id="upvote-button">Upvote</button>
                    <span id="upvote-count">0</span> upvotes
                </div>
            </div>
        </article>

        <script>
            // Graphviz rendering
            function d3ize(elem) {
                var par = elem.parentElement;
                d3.select(par)
                    .append("div")
                    .graphviz()
                    .renderDot(elem.innerText);
                d3.select(elem).style("display", "none");
            }

            document.addEventListener("DOMContentLoaded", function () {
                var dotelems = document.getElementsByClassName("language-dot");
                for (let elem of dotelems) {
                    d3ize(elem);
                }

                // Upvote functionality
                const upvoteButton = document.getElementById("upvote-button");
                const upvoteCount = document.getElementById("upvote-count");
                const postId = "{{ page.id | slugify }}";

                // Load current upvote count
                fetch(`/upvotes/${postId}_stats.txt`)
                    .then((response) => {
                        if (!response.ok) {
                            throw new Error("File not found");
                        }
                        return response.text();
                    })
                    .then((count) => {
                        upvoteCount.textContent = count.trim();
                    })
                    .catch(() => {
                        console.log(
                            "Upvote file not found. This is normal for local development.",
                        );
                        upvoteCount.textContent = "0";
                    });

                upvoteButton.addEventListener("click", function () {
                    let currentCount = parseInt(upvoteCount.textContent) || 0;
                    upvoteCount.textContent = (currentCount + 1).toString();

                    // In production, this would trigger the GitHub Action
                    // For local development, we're just updating the count in the DOM
                    if (
                        window.location.hostname === "localhost" ||
                        window.location.hostname === "127.0.0.1"
                    ) {
                        console.log(
                            "Local environment detected. Skipping GitHub API call.",
                        );
                        return;
                    }

                    fetch(
                        "https://api.github.com/repos/{{ site.github.owner_name }}/{{ site.github.repository_name }}/dispatches",
                        {
                            method: "POST",
                            headers: {
                                Authorization: "token ${UPVOTE_EVERYTIME}",
                                Accept: "application/vnd.github.v3+json",
                            },
                            body: JSON.stringify({
                                event_type: "upvote",
                                client_payload: { post_id: postId },
                            }),
                        },
                    ).catch((error) => console.error("Error:", error));
                });
            });
        </script>
    </body>
</html>
